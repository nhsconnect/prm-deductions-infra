format_version: 4
#common:
#  deploy_job: &deploy_job
#    resources:
#      - docker
#    tasks:
#      - exec:
#          command: /bin/bash
#          arguments:
#            - -c
#            - ./tasks tf_plan_dashboard create
#      - exec:
#          command: /bin/bash
#          arguments:
#            - -c
#            - ./tasks tf_apply_dashboard

pipelines:
  "prm-deductions-infra-dashboard":
    group: continuity-service
    label_template: "${git[:8]}"
    materials:
      git:
        type: configrepo
        whitelist:
          - terraform-dashboard/**/*.*
    stages:
      - deploy_dev:
          clean_workspace: true
          resources:
            - docker
          environment_variables:
            NHS_ENVIRONMENT: dev
          tasks:
            - exec:
                command: /bin/bash
                arguments:
                  - -c
                  - ./tasks tf_plan_dashboard create
            - exec:
                command: /bin/bash
                arguments:
                  - -c
                  - ./tasks tf_apply_dashboard
#
#      - deploy_test:
#          clean_workspace: true
#          resources:
#            - docker
#          environment_variables:
#            NHS_ENVIRONMENT: test
#          tasks:
#            *deploy_job
