{
  "widgets": [
    {
      "height": 6,
      "width": 6,
      "y": 0,
      "x": 6,
      "type": "metric",
      "properties": {
        "metrics": [
          [ "NemsEventProcessor", "ErrorCountInLogs", { "visible": false } ],
          [ ".", "Health", "Environment", "${environment}", { "visible": false } ],
          [ "AWS/SQS", "ApproximateAgeOfOldestMessage", "QueueName", "${mesh_forwarder_nems_observability_queue}" ],
          [ ".", "NumberOfMessagesSent", ".", "." ],
          [ ".", "NumberOfMessagesReceived", ".", "." ],
          [ ".", "ApproximateNumberOfMessagesDelayed", ".", "." ],
          [ ".", "ApproximateNumberOfMessagesVisible", ".", "." ],
          [ ".", "SentMessageSize", ".", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "stat": "Average",
        "period": 300,
        "title": "Nems-OBS-Metrics"
      }
    },
    {
      "height": 6,
      "width": 6,
      "y": 0,
      "x": 12,
      "type": "metric",
      "properties": {
        "metrics": [
          [ "NemsEventProcessor", "ErrorCountInLogs", { "visible": false } ],
          [ ".", "Health", "Environment", "${environment}", { "visible": false } ],
          [ "AWS/ECS", "CPUUtilization", "ServiceName", "${environment}-nems-event-processor-service", "ClusterName", "${environment}-nems-event-processor-ecs-cluster" ],
          [ ".", "MemoryUtilization", ".", ".", ".", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "stat": "Average",
        "period": 300,
        "title": "Nems-Container"
      }
    },
    {
      "height": 6,
      "width": 6,
      "y": 6,
      "x": 0,
      "type": "metric",
      "properties": {
        "metrics": [
          [ "NemsEventProcessor", "ErrorCountInLogs", { "visible": false, "id": "m1" } ],
          [ ".", "Health", "Environment", "${environment}", { "visible": false, "id": "m2" } ],
          [ "MeshForwarder", "MeshInboxMessageCount", { "id": "m3" } ],
          [ { "expression": "ANOMALY_DETECTION_BAND(m3, 2)", "label": "MeshForwarder MeshInboxMessageCount (expected)", "id": "ad1", "color": "#95A5A6" } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "stat": "Average",
        "period": 300,
        "title": "MeshInboxMessageCount"
      }
    },
    {
      "height": 6,
      "width": 6,
      "y": 0,
      "x": 0,
      "type": "metric",
      "properties": {
        "metrics": [
          [ "NemsEventProcessor", "ErrorCountInLogs", { "visible": false, "id": "m1" } ],
          [ ".", "Health", "Environment", "${environment}" ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "stat": "Average",
        "period": 300,
        "title": "Nems Health"
      }
    },
    {
      "height": 6,
      "width": 6,
      "y": 0,
      "x": 18,
      "type": "metric",
      "properties": {
        "metrics": [
          [ "NemsEventProcessor", "ErrorCountInLogs", { "id": "m1" } ],
          [ ".", "Health", "Environment", "${environment}", { "visible": false } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "stat": "Average",
        "period": 300,
        "title": "Nems-Error-Count"
      }
    },
    {
      "height": 6,
      "width": 6,
      "y": 6,
      "x": 6,
      "type": "metric",
      "properties": {
        "metrics": [
          [ "NemsEventProcessor", "ErrorCountInLogs", { "id": "m1", "visible": false } ],
          [ "MeshForwarder", "." ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "stat": "Average",
        "period": 300,
        "start": "-PT3H",
        "end": "P0D",
        "title": "Mesh-Error-Count"
      }
    },
    {
      "height": 6,
      "width": 6,
      "y": 6,
      "x": 12,
      "type": "metric",
      "properties": {
        "metrics": [
          [ "NemsEventProcessor", "ErrorCountInLogs", { "id": "m1", "visible": false } ],
          [ "PdsAdaptor", "Error Count" ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "stat": "Average",
        "period": 300,
        "start": "-PT3H",
        "end": "P0D",
        "title": "PDS-Error Count"
      }
    },
    {
      "type": "log",
      "y": 12,
      "x": 0,
      "properties": {
          "query": "SOURCE '/aws/ecs/containerinsights/${environment}-nems-event-processor-ecs-cluster/performance' | fields CpuUtilized / CpuReserved * 100 as CpuUtilizedPercent, (AvailabilityZone like \"eu-west-2b\") as is_eu_west_2b, (AvailabilityZone like \"eu-west-2a\") as is_eu_west_2a\n| filter (Type = \"Task\")\n| stats sum(CpuUtilizedPercent * is_eu_west_2b) as eu_west_2b, sum(CpuUtilizedPercent * is_eu_west_2a) as eu_west_2a by bin(2m) as period\n| sort period desc",
          "region": "eu-west-2",
          "title": "Nems Events Processor Container",
          "view": "timeSeries",
          "stacked": false
      }
    }
  ]
}